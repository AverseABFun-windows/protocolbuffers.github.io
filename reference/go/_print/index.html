<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.108.0"><link rel=canonical type=text/html href=https://protobuf.dev/reference/go/><link rel=alternate type=application/rss+xml href=https://protobuf.dev/reference/go/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Go Reference | Protocol Buffers Documentation</title><meta name=description content="This section contains reference documentation for working with protocol buffer classes in Go"><meta property="og:title" content="Go Reference"><meta property="og:description" content="This section contains reference documentation for working with protocol buffer classes in Go"><meta property="og:type" content="website"><meta property="og:url" content="https://protobuf.dev/reference/go/"><meta property="og:site_name" content="Protocol Buffers Documentation"><meta itemprop=name content="Go Reference"><meta itemprop=description content="This section contains reference documentation for working with protocol buffer classes in Go"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go Reference"><meta name=twitter:description content="This section contains reference documentation for working with protocol buffer classes in Go"><link rel=preload href=/scss/main.min.def2cdda5cfcd95d9660c969a68946395435ad5fc75402be473d9995c7e926b3.css as=style><link href=/scss/main.min.def2cdda5cfcd95d9660c969a68946395435ad5fc75402be473d9995c7e926b3.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"></ul></div><div class="navbar-nav d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/reference/go/>Return to the regular view of this page</a>.</p></div><h1 class=title>Go Reference</h1><div class=lead>This section contains reference documentation for working with protocol buffer classes in Go</div><ul><li>1: <a href=#pg-6bcd6bf4ea08bfaf106c75c33f1776ba>Go Generated Code Guide</a></li><li>2: <a href=#pg-b308d39fa92ddbafc45777b9e304fffa>Go FAQ</a></li><li>3: <a href=#pg-639e5cf8cb099a7e10c83b371a06eedd>Go API</a></li></ul><div class=content><ul><li><p><a href=/reference/go/go-generated>Go Generated Code Guide</a></p></li><li><p><a href=https://pkg.go.dev/google.golang.org/protobuf/proto>Go API (godoc)</a></p></li><li><p><a href=/reference/go/faq>Go FAQ</a></p></li></ul></div></div><div class=td-content><h1 id=pg-6bcd6bf4ea08bfaf106c75c33f1776ba>1 - Go Generated Code Guide</h1><div class=lead>This topic describes exactly what Go code the protocol buffer compiler generates for any given protocol definition.</div><p>This page describes exactly what Go code the protocol buffer compiler generates
for any given protocol definition. Any differences between proto2 and proto3
generated code are highlighted - note that these differences are in the
generated code as described in this document, not the base API, which are the
same in both versions. You should read the
<a href=/programming-guides/proto>proto2 language guide</a> and/or the
<a href=/programming-guides/proto3>proto3 language guide</a> before reading this
document.</p><h2 id=invocation>Compiler Invocation</h2><p>The protocol buffer compiler requires a plugin to generate Go code. Install it
using Go 1.16 or higher by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
</span></span></code></pre></div><p>This will install a <code>protoc-gen-go</code> binary in <code>$GOBIN</code>. Set the <code>$GOBIN</code>
environment variable to change the installation location. It must be in your
<code>$PATH</code> for the protocol buffer compiler to find it.</p><p>The protocol buffer compiler produces Go output when invoked with the <code>go_out</code>
flag. The argument to the <code>go_out</code> flag is the directory where you want the
compiler to write your Go output. The compiler creates a single source file for
each <code>.proto</code> file input. The name of the output file is created by replacing
the <code>.proto</code> extension with <code>.pb.go</code>.</p><p>Where in the output directory the generated <code>.pb.go</code> file is placed depends on
the compiler flags. There are several output modes:</p><ul><li>If the <code>paths=import</code> flag is specified, the output file is placed in a
directory named after the Go package&rsquo;s import path. For example, an input
file <code>protos/buzz.proto</code> with a Go import path of
<code>example.com/project/protos/fizz</code> results in an output file at
<code>example.com/project/protos/fizz/buzz.pb.go</code>. This is the default output
mode if a <code>paths</code> flag is not specified.</li><li>If the <code>module=$PREFIX</code> flag is specified, the output file is placed in a
directory named after the Go package&rsquo;s import path, but with the specified
directory prefix removed from the output filename. For example, an input
file <code>protos/buzz.proto</code> with a Go import path of
<code>example.com/project/protos/fizz</code> and <code>example.com/project</code> specified as the
<code>module</code> prefix results in an output file at <code>protos/fizz/buzz.pb.go</code>.
Generating any Go packages outside the module path results in an error. This
mode is useful for outputting generated files directly into a Go module.</li><li>If the <code>paths=source_relative</code> flag is specified, the output file is placed
in the same relative directory as the input file. For example, an input file
<code>protos/buzz.proto</code> results in an output file at <code>protos/buzz.pb.go</code>.</li></ul><p>Flags specific to <code>protoc-gen-go</code> are provided by passing a <code>go_opt</code> flag when
invoking <code>protoc</code>. Multiple <code>go_opt</code> flags may be passed. For example, when
running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc --proto_path<span style=color:#ce5c00;font-weight:700>=</span>src --go_out<span style=color:#ce5c00;font-weight:700>=</span>out --go_opt<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>paths</span><span style=color:#ce5c00;font-weight:700>=</span>source_relative foo.proto bar/baz.proto
</span></span></code></pre></div><p>the compiler will read input files <code>foo.proto</code> and <code>bar/baz.proto</code> from within
the <code>src</code> directory, and write output files <code>foo.pb.go</code> and <code>bar/baz.pb.go</code> to
the <code>out</code> directory. The compiler automatically creates nested output
sub-directories if necessary, but will not create the output directory itself.</p><h2 id=package>Packages</h2><p>In order to generate Go code, the Go package&rsquo;s import path must be provided for
every <code>.proto</code> file (including those transitively depended upon by the <code>.proto</code>
files being generated). There are two ways to specify the Go import path:</p><ul><li>by declaring it within the <code>.proto</code> file, or</li><li>by declaring it on the command line when invoking <code>protoc</code>.</li></ul><p>We recommend declaring it within the <code>.proto</code> file so that the Go packages for
<code>.proto</code> files can be centrally identified with the <code>.proto</code> files themselves
and to simplify the set of flags passed when invoking <code>protoc</code>. If the Go import
path for a given <code>.proto</code> file is provided by both the <code>.proto</code> file itself and
on the command line, then the latter takes precedence over the former.</p><p>The Go import path is locally specified in a <code>.proto</code> file by declaring a
<code>go_package</code> option with the full import path of the Go package. Example usage:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>go_package</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;example.com/project/protos/fizz&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The Go import path may be specified on the command line when invoking the
compiler, by passing one or more <code>M${PROTO_FILE}=${GO_IMPORT_PATH}</code> flags.
Example usage:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc --proto_path<span style=color:#ce5c00;font-weight:700>=</span>src <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --go_opt<span style=color:#ce5c00;font-weight:700>=</span>Mprotos/buzz.proto<span style=color:#ce5c00;font-weight:700>=</span>example.com/project/protos/fizz <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --go_opt<span style=color:#ce5c00;font-weight:700>=</span>Mprotos/bar.proto<span style=color:#ce5c00;font-weight:700>=</span>example.com/project/protos/foo <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  protos/buzz.proto protos/bar.proto
</span></span></code></pre></div><p>Since the mapping of all <code>.proto</code> files to their Go import paths can be quite
large, this mode of specifying the Go import paths is generally performed by
some build tool (e.g., <a href=https://bazel.build/>Bazel</a>) that has
control over the entire dependency tree. If there are duplicate entries for a
given <code>.proto</code> file, then the last one specified takes precedence.</p><p>For both the <code>go_package</code> option and the <code>M</code> flag, the value may include an
explicit package name separated from the import path by a semicolon. For
example: <code>"example.com/protos/foo;package_name"</code>. This usage is discouraged
since the package name will be derived by default from the import path in a
reasonable manner.</p><p>The import path is used to determine which import statements must be generated
when one <code>.proto</code> file imports another <code>.proto</code> file. For example, if <code>a.proto</code>
imports <code>b.proto</code>, then the generated <code>a.pb.go</code> file needs to import the Go
package which contains the generated <code>b.pb.go</code> file (unless both files are in
the same package). The import path is also used to construct output filenames.
See the "Compiler Invocation" section above for details.</p><p>There is no correlation between the Go import path and the
<a href=/programming-guides/proto3#packages><code>package</code> specifier</a> in the <code>.proto</code>
file. The latter is only relevant to the protobuf namespace, while the former is
only relevant to the Go namespace. Also, there is no correlation between the Go
import path and the <code>.proto</code> import path.</p><h2 id=message>Messages</h2><p>Given a simple message declaration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>the protocol buffer compiler generates a struct called <code>Foo</code>. A <code>*Foo</code>
implements the
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#Message"><code>proto.Message</code></a>
interface.</p><p>The
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc"><code>proto</code> package</a>
provides functions which operate on messages, including conversion to and from
binary format.</p><p>The <code>proto.Message</code> interface defines a <code>ProtoReflect</code> method. This method
returns a
<a href="https://pkg.go.dev/google.golang.org/protobuf/reflect/protoreflect?tab=doc#Message"><code>protoreflect.Message</code></a>
which provides a reflection-based view of the message.</p><p>The <code>optimize_for</code> option does not affect the output of the Go code generator.</p><h3 id=nested-types>Nested Types</h3><p>A message can be declared inside another message. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In this case, the compiler generates two structs: <code>Foo</code> and <code>Foo_Bar</code>.</p><h2 id=fields>Fields</h2><p>The protocol buffer compiler generates a struct field for each field defined
within a message. The exact nature of this field depends on its type and whether
it is a singular, repeated, map, or oneof field.</p><p>Note that the generated Go field names always use camel-case naming, even if the
field name in the <code>.proto</code> file uses lower-case with underscores
(<a href=/programming-guides/style>as it should</a>). The case-conversion works as
follows:</p><ol><li>The first letter is capitalized for export. If the first character is an
underscore, it is removed and a capital X is prepended.</li><li>If an interior underscore is followed by a lower-case letter, the underscore
is removed, and the following letter is capitalized.</li></ol><p>Thus, the proto field <code>foo_bar_baz</code> becomes <code>FooBarBaz</code> in Go, and
<code>_my_field_name_2</code> becomes <code>XMyFieldName_2</code>.</p><h3 id=singular-scalar-proto2>Singular Scalar Fields (proto2)</h3><p>For either of these field definitions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>required</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>the compiler generates a struct with an <code>*int32</code> field named <code>Foo</code> and an
accessor method <code>GetFoo()</code> which returns the <code>int32</code> value in <code>Foo</code> or the
default value if the field is unset. If the default is not explicitly set, the
<a href=https://golang.org/ref/spec#The_zero_value>zero value</a> of that type
is used instead (<code>0</code> for numbers, the empty string for strings).</p><p>For other scalar field types (including <code>bool</code>, <code>bytes</code>, and <code>string</code>), <code>*int32</code>
is replaced with the corresponding Go type according to the
<a href=/programming-guides/proto#scalar>scalar value types table</a>.</p><h3 id=singular-scalar-proto3>Singular Scalar Fields (proto3)</h3><p>For this field definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The compiler will generate a struct with an <code>int32</code> field named <code>Foo</code> and an
accessor method <code>GetFoo()</code> which returns the <code>int32</code> value in <code>Foo</code> or the
<a href=https://golang.org/ref/spec#The_zero_value>zero value</a> of that type
if the field is unset (<code>0</code> for numbers, the empty string for strings).</p><p>For other scalar field types (including <code>bool</code>, <code>bytes</code>, and <code>string</code>), <code>int32</code>
is replaced with the corresponding Go type according to the
<a href=/programming-guides/proto3#scalar>scalar value types table</a>. Unset values
in the proto will be represented as the
<a href=https://golang.org/ref/spec#The_zero_value>zero value</a> of that type
(<code>0</code> for numbers, the empty string for strings).</p><h3 id=singular-message>Singular Message Fields</h3><p>Given the message type:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>For a message with a <code>Bar</code> field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// proto2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Baz</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Bar</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// The generated code is the same result if required instead of optional.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// proto3
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Baz</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>Bar</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The compiler will generate a Go struct</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Baz</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Foo</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Bar</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Message fields can be set to <code>nil</code>, which means that the field is unset,
effectively clearing the field. This is not equivalent to setting the value to
an "empty" instance of the message struct.</p><p>The compiler also generates a <code>func (m *Baz) GetFoo() *Bar</code> helper function.
This function returns a <code>nil</code> <code>*Bar</code> if <code>m</code> is nil or <code>foo</code> is unset. This makes
it possible to chain get calls without intermediate <code>nil</code> checks.</p><h3 id=repeated>Repeated Fields</h3><p>Each repeated field generates a slice of <code>T</code> field in the struct in Go, where
<code>T</code> is the field&rsquo;s element type. For this message with a repeated field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Baz</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Bar</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>the compiler generates the Go struct:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Baz</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Foo</span>  <span style=color:#000;font-weight:700>[]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Bar</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Likewise, for the field definition <code>repeated bytes foo = 1;</code> the compiler will
generate a Go struct with a <code>[][]byte</code> field named <code>Foo</code>. For a repeated
<a href=#enum>enumeration</a> <code>repeated MyEnum bar = 2;</code>, the compiler generates a struct
with a <code>[]MyEnum</code> field called <code>Bar</code>.</p><p>The following example shows how to set the field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>baz</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>Baz</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Bar</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{},</span> <span style=color:#8f5902;font-style:italic>// First element.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000;font-weight:700>{},</span> <span style=color:#8f5902;font-style:italic>// Second element.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>To access the field, you can do the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>baz</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetFoo</span><span style=color:#000;font-weight:700>()</span> <span style=color:#8f5902;font-style:italic>// foo type is []*Bar.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>b1</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>foo</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#8f5902;font-style:italic>// b1 type is *Bar, the first element in foo.
</span></span></span></code></pre></div><h3 id=map>Map Fields</h3><p>Each map field generates a field in the struct of type <code>map[TKey]TValue</code> where
<code>TKey</code> is the field&rsquo;s key type and <code>TValue</code> is the field&rsquo;s value type. For this
message with a map field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Baz</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>map</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>the compiler generates the Go struct:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Baz</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Foo</span> <span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Bar</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=oneof>Oneof Fields</h3><p>For a oneof field, the protobuf compiler generates a single field with an
interface type <code>isMessageName_MyField</code>. It also generates a struct for each of
the <a href=#singular-scalar-proto2>singular fields</a> within the oneof. These all
implement this <code>isMessageName_MyField</code> interface.</p><p>For this message with a oneof field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>account</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Profile</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>avatar</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>image_url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>bytes</span> <span style=color:#000>image_data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>the compiler generates the structs:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Profile</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Types that are valid to be assigned to Avatar:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>//  *Profile_ImageUrl
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>//  *Profile_ImageData
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>Avatar</span> <span style=color:#000>isProfile_Avatar</span> <span style=color:#4e9a06>`protobuf_oneof:&#34;avatar&#34;`</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Profile_ImageUrl</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>ImageUrl</span> <span style=color:#204a87;font-weight:700>string</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Profile_ImageData</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>ImageData</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>byte</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Both <code>*Profile_ImageUrl</code> and <code>*Profile_ImageData</code> implement <code>isProfile_Avatar</code>
by providing an empty <code>isProfile_Avatar()</code> method.</p><p>The following example shows how to set the field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>p1</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>account</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Avatar</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>account</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageUrl</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;http://example.com/image.png&#34;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// imageData is []byte
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>imageData</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>getImageData</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>p2</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>account</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Avatar</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>account</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageData</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>imageData</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>To access the field, you can use a type switch on the value to handle the
different message types.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Avatar</span><span style=color:#000;font-weight:700>.(</span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>account</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageUrl</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Load profile image based on URL
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// using x.ImageUrl
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>account</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Profile_ImageData</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Load profile image based on bytes
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>// using x.ImageData
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// The field is not set.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Profile.Avatar has unexpected type %T&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The compiler also generates get methods <code>func (m *Profile) GetImageUrl() string</code>
and <code>func (m *Profile) GetImageData() []byte</code>. Each get function returns the
value for that field or the zero value if it is not set.</p><h2 id=enum>Enumerations</h2><p>Given an enumeration like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Corpus</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>UNIVERSAL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>WEB</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>IMAGES</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>LOCAL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>NEWS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PRODUCTS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VIDEO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>Corpus</span> <span style=color:#000>corpus</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>the protocol buffer compiler generates a type and a series of constants with
that type.</p><p>For enums within a message (like the one above), the type name begins with the
message name:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>SearchRequest_Corpus</span> <span style=color:#204a87;font-weight:700>int32</span>
</span></span></code></pre></div><p>For a package-level enum:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>DEFAULT_BAR</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>BAR_BELLS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>BAR_B_CUE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>the Go type name is unmodified from the proto enum name:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Foo</span> <span style=color:#204a87;font-weight:700>int32</span>
</span></span></code></pre></div><p>This type has a <code>String()</code> method that returns the name of a given value.</p><p>The <code>Enum()</code> method initializes freshly allocated memory with a given value and
returns the corresponding pointer:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>Foo</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>Enum</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Foo</span>
</span></span></code></pre></div><p>The protocol buffer compiler generates a constant for each value in the enum.
For enums within a message, the constants begin with the enclosing message&rsquo;s
name:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SearchRequest_UNIVERSAL</span> <span style=color:#000>SearchRequest_Corpus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SearchRequest_WEB</span>       <span style=color:#000>SearchRequest_Corpus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SearchRequest_IMAGES</span>    <span style=color:#000>SearchRequest_Corpus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SearchRequest_LOCAL</span>     <span style=color:#000>SearchRequest_Corpus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SearchRequest_NEWS</span>      <span style=color:#000>SearchRequest_Corpus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SearchRequest_PRODUCTS</span>  <span style=color:#000>SearchRequest_Corpus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>    <span style=color:#000>SearchRequest_VIDEO</span>     <span style=color:#000>SearchRequest_Corpus</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>For a package-level enum, the constants begin with the enum name instead:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Foo_DEFAULT_BAR</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Foo_BAR_BELLS</span>   <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Foo_BAR_B_CUE</span>   <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>The protobuf compiler also generates a map from integer values to the string
names and a map from the names to the values:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>Foo_name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>int32</span><span style=color:#000;font-weight:700>]</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;DEFAULT_BAR&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;BAR_BELLS&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;BAR_B_CUE&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>Foo_value</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#204a87;font-weight:700>int32</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;DEFAULT_BAR&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;BAR_BELLS&#34;</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;BAR_B_CUE&#34;</span><span style=color:#000;font-weight:700>:</span>   <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Note that the <code>.proto</code> language allows multiple enum symbols to have the same
numeric value. Symbols with the same numeric value are synonyms. These are
represented in Go in exactly the same way, with multiple names corresponding to
the same numeric value. The reverse mapping contains a single entry for the
numeric value to the name which appears first in the .proto file.</p><h2 id=extensions>Extensions (proto2)</h2><p>Given an extension definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The protocol buffer compiler will generate a
<a href="https://pkg.go.dev/google.golang.org/protobuf/reflect/protoreflect?tab=doc#ExtensionType"><code>protoreflect.ExtensionType</code></a>
value named <code>E_Bar</code>. This value may be used with the
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#GetExtension"><code>proto.GetExtension</code></a>,
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#SetExtension"><code>proto.SetExtension</code></a>,
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#HasExtension"><code>proto.HasExtension</code></a>,
and
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#ClearExtension"><code>proto.ClearExtension</code></a>
functions to access an extension in a message. The <code>GetExtension</code> function and
<code>SetExtension</code> functions respectively accept and return an <code>interface{}</code> value
containing the extension value type.</p><p>For singular scalar extension fields, the extension value type is the
corresponding Go type from the
<a href=/programming-guides/proto3#scalar>scalar value types table</a>.</p><p>For singular embedded message extension fields, the extension value type is
<code>*M</code>, where <code>M</code> is the field message type.</p><p>For repeated extension fields, the extension value type is a slice of the
singular type.</p><p>For example, given the following definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>singular_int32</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>bytes</span> <span style=color:#000>repeated_string</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Bar</span> <span style=color:#000>singular_message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Extension values may be accessed as:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>somepb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>extpb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>E_SingularInt32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>int32</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>extpb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>E_RepeatedString</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;a&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;b&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;c&#34;</span><span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>extpb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>E_SingularMessage</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>extpb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Bar</span><span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>v1</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>extpb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>E_SingularInt32</span><span style=color:#000;font-weight:700>).(</span><span style=color:#204a87;font-weight:700>int32</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>v2</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>extpb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>E_RepeatedString</span><span style=color:#000;font-weight:700>).([][]</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>v3</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>extpb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>E_SingularMessage</span><span style=color:#000;font-weight:700>).(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>extpb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Bar</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Extensions can be declared nested inside of another type. For example, a common
pattern is to do something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Baz</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Baz</span> <span style=color:#000>foo_ext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>124</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In this case, the <code>ExtensionType</code> value is named <code>E_Baz_Foo</code>.</p><h2 id=service>Services</h2><p>The Go code generator does not produce output for services by default. If you
enable the <a href=https://www.grpc.io/>gRPC</a> plugin (see the
<a href=https://github.com/grpc/grpc-go/tree/master/examples>gRPC Go Quickstart guide</a>)
then code will be generated to support gRPC.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b308d39fa92ddbafc45777b9e304fffa>2 - Go FAQ</h1><div class=lead>This topic has a list of frequently asked questions about implementing protocol buffers in Go, with answer for each.</div><h2 id=versions>Versions</h2><h3 id=modules>What&rsquo;s the difference between <code>github.com/golang/protobuf</code> and <code>google.golang.org/protobuf</code>?</h3><p>The
<a href="https://pkg.go.dev/github.com/golang/protobuf?tab=overview"><code>github.com/golang/protobuf</code></a>
module is the original Go protocol buffer API.</p><p>The
<a href="https://pkg.go.dev/google.golang.org/protobuf?tab=overview"><code>google.golang.org/protobuf</code></a>
module is an updated version of this API designed for simplicity, ease of use,
and safety. The flagship features of the updated API are support for reflection
and a separation of the user-facing API from the underlying implementation.</p><p>We recommend that you use <code>google.golang.org/protobuf</code> in new code.</p><p>Version <code>v1.4.0</code> and higher of <code>github.com/golang/protobuf</code> wrap the new
implementation and permit programs to adopt the new API incrementally. For
example, the well-known types defined in <code>github.com/golang/protobuf/ptypes</code> are
simply aliases of those defined in the newer module. Thus,
<a href=https://pkg.go.dev/google.golang.org/protobuf/types/known/emptypb><code>google.golang.org/protobuf/types/known/emptypb</code></a>
and
<a href=https://pkg.go.dev/github.com/golang/protobuf/ptypes/empty><code>github.com/golang/protobuf/ptypes/empty</code></a>
may be used interchangeably.</p><h3 id=proto-versions>What are <code>proto1</code>, <code>proto2</code>, and <code>proto3</code>?</h3><p>These are revisions of the protocol buffer <em>language</em>. It is different from the
Go <em>implementation</em> of protobufs.</p><ul><li><p><code>proto3</code> is the current version of the language. This is the most commonly
used version of the language. We encourage new code to use proto3.</p></li><li><p><code>proto2</code> is an older version of the language. Despite being superseded by
proto3, proto2 is still fully supported.</p></li><li><p><code>proto1</code> is an obsolete version of the language. It was never released as
open source.</p></li></ul><h3 id=message-types>There are several different <code>Message</code> types. Which should I use?</h3><ul><li><p><a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#Message"><code>"google.golang.org/protobuf/proto".Message</code></a>
is an interface type implemented by all messages generated by the current
version of the protocol buffer compiler. Functions that operate on arbitrary
messages, such as
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#Marshal"><code>proto.Marshal</code></a>
or
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#Clone"><code>proto.Clone</code></a>,
accept or return this type.</p></li><li><p><a href="https://pkg.go.dev/google.golang.org/protobuf/reflect/protoreflect?tab=doc#Message"><code>"google.golang.org/protobuf/reflect/protoreflect".Message</code></a>
is an interface type describing a reflection view of a message.</p><p>Call the <code>ProtoReflect</code> method on a <code>proto.Message</code> to get a
<code>protoreflect.Message</code>.</p></li><li><p><a href="https://pkg.go.dev/google.golang.org/protobuf/reflect/protoreflect?tab=doc#ProtoMessage"><code>"google.golang.org/protobuf/reflect/protoreflect".ProtoMessage</code></a>
is an alias of <code>"google.golang.org/protobuf/proto".Message</code>. The two types
are interchangeable.</p></li><li><p><a href="https://pkg.go.dev/github.com/golang/protobuf/proto?tab=doc#Message"><code>"github.com/golang/protobuf/proto".Message</code></a>
is an interface type defined by the legacy Go protocol buffer API. All
generated message types implement this interface, but the interface does not
describe the behavior expected from these messages. New code should avoid
using this type.</p></li></ul><h2 id=common-problems>Common problems</h2><h3 id=working-directory>&ldquo;<code>go install</code>&rdquo;: <code>working directory is not part of a module</code></h3><p>On Go 1.15 and below, you have set the environment variable <code>GO111MODULE=on</code> and
are running the <code>go install</code> command outside of a module directory. Set
<code>GO111MODULE=auto</code>, or unset the environment variable.</p><p>On Go 1.16 and above, <code>go install</code> can be invoked outside of a module by
specifying an explicit version: <code>go install google.golang.org/protobuf/cmd/protoc-gen-go@latest</code></p><h3 id=enforce-version><code>constant -1 overflows protoimpl.EnforceVersion</code></h3><p>You are using a generated <code>.pb.go</code> file which requires a newer version of the
<code>"google.golang.org/protobuf"</code> module.</p><p>Update to a newer version with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>go get -u google.golang.org/protobuf/proto
</span></span></code></pre></div><h3 id=enforce-version-apiv1><code>undefined: "github.com/golang/protobuf/proto".ProtoPackageIsVersion4</code></h3><p>You are using a generated <code>.pb.go</code> file which requires a newer version of the
<code>"github.com/golang/protobuf"</code> module.</p><p>Update to a newer version with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>go get -u github.com/golang/protobuf/proto
</span></span></code></pre></div><h3 id=namespace-conflict>What is a protocol buffer namespace conflict?</h3><p>All protocol buffers declarations linked into a Go binary are inserted into a
global registry.</p><p>Every protobuf declaration (for example, enums, enum values, or messages) has an
absolute name, which is the concatenation of the
<a href=/programming-guides/proto#packages>package name</a> with
the relative name of the declaration in the <code>.proto</code> source file (for example,
<code>my.proto.package.MyMessage.NestedMessage</code>). The protobuf language assumes that
all declarations are universally unique.</p><p>If two protobuf declarations linked into a Go binary have the same name, then
this leads to a namespace conflict, and it is impossible for the registry to
properly resolve that declaration by name. Depending on which version of Go
protobufs is being used, this will either panic at init-time or silently drop
the conflict and lead to a potential bug later during runtime.</p><h3 id=fix-namespace-conflict>How do I fix a protocol buffer namespace conflict?</h3><p>The way to best fix a namespace conflict depends on the reason why a conflict is
occurring.</p><p>Common ways that namespace conflicts occur:</p><ul><li><p><strong>Vendored .proto files.</strong> When a single <code>.proto</code> file is generated into two
or more Go packages and linked into the same Go binary, it conflicts on
every protobuf declaration in the generated Go packages. This typically
occurs when a <code>.proto</code> file is vendored and a Go package is generated from
it, or the generated Go package itself is vendored. Users should avoid
vendoring and instead depend on a centralized Go package for that <code>.proto</code>
file.</p><ul><li>If a <code>.proto</code> file is owned by an external party and is lacking a
<code>go_package</code> option, then you should coordinate with the owner of that
<code>.proto</code> file to specify a centralized Go package that a plurality of
users can all depend on.</li></ul></li><li><p><strong>Missing or generic proto package names.</strong> If a <code>.proto</code> file does not
specify a package name or uses an overly generic package name (for example,
&ldquo;my_service&rdquo;), then there is a high probability that declarations within
that file will conflict with other declarations elsewhere in the universe.
We recommend that every <code>.proto</code> file have a package name that is
deliberately chosen to be universally unique (for example, prefixed with the
name of a company).</p><ul><li>Warning: Retroactively changing the package name on a <code>.proto</code> file can
potentially cause the use of extension fields or messages stored in
<code>google.protobuf.Any</code> to stop working properly.</li></ul></li></ul><p>Starting with v1.26.0 of the <code>google.golang.org/protobuf</code> module, a hard error
will be reported when a Go program starts up that has multiple conflicting
protobuf names linked into it. While it is preferable that the source of the
conflict be fixed, the fatal error can be immediately worked around in one of
two ways:</p><ol><li><p><strong>At compile time.</strong> The default behavior for handling conflicts can be
specified at compile time with a linker-initialized variable: <code>go build -ldflags "-X google.golang.org/protobuf/reflect/protoregistry.conflictPolicy=warn"</code></p></li><li><p><strong>At program execution.</strong> The behavior for handling conflicts when executing
a particular Go binary can be set with an environment variable:
<code>GOLANG_PROTOBUF_REGISTRATION_CONFLICT=warn ./main</code></p></li></ol><h3 id=deepequal>Why does <code>reflect.DeepEqual</code> behave unexpectedly with protobuf messages?</h3><p>Generated protocol buffer message types include internal state which can vary
even between equivalent messages.</p><p>In addition, the <code>reflect.DeepEqual</code> function is not aware of the semantics of
protocol buffer messages, and can report differences where none exist. For
example, a map field containing a <code>nil</code> map and one containing a zero-length,
non-<code>nil</code> map are semantically equivalent, but will be reported as unequal by
<code>reflect.DeepEqual</code>.</p><p>Use the
<a href=https://pkg.go.dev/google.golang.org/protobuf/proto#Equal><code>proto.Equal</code></a>
function to compare message values.</p><p>In tests, you can also use the
<a href="https://pkg.go.dev/github.com/google/go-cmp/cmp?tab=doc"><code>"github.com/google/go-cmp/cmp"</code></a>
package with the
<a href=https://pkg.go.dev/google.golang.org/protobuf/testing/protocmp#Transform><code>protocmp.Transform()</code></a>
option. The <code>cmp</code> package can compare arbitrary data structures, and
<a href=https://pkg.go.dev/github.com/google/go-cmp/cmp#Diff><code>cmp.Diff</code></a> produces
human-readable reports of the differences between values.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>diff</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>cmp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Diff</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>b</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>protocmp</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Transform</span><span style=color:#000;font-weight:700>());</span> <span style=color:#000>diff</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#34;&#34;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>t</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unexpected difference:\n%v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>diff</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=hyrums-law>Hyrum&rsquo;s Law</h2><h3 id=hyrums-law>What is Hyrum&rsquo;s Law, and why is it in this FAQ?</h3><p><a href=https://www.hyrumslaw.com/>Hyrum&rsquo;s Law</a> states:</p><blockquote><p>With a sufficient number of users of an API, it does not matter what you
promise in the contract: all observable behaviors of your system will be
depended on by somebody.</p></blockquote><p>A design goal of the latest version of the Go protocol buffer API is to avoid,
where possible, providing observable behaviors that we cannot promise to keep
stable in the future. It is our philosophy that deliberate instability in areas
where we make no promises is better than giving the illusion of stability, only
for that to change in the future after a project has potentially been long
depending on that false assumption.</p><h3 id=unstable-errors>Why does the text of errors keep changing?</h3><p>Tests depending on the exact text of errors are brittle and break often when
that text changes. To discourage unsafe use of error text in tests, the text of
errors produced by this module is deliberately unstable.</p><p>If you need to identify whether an error is produced by the
<a href=https://pkg.go.dev/mod/google.golang.org/protobuf><code>protobuf</code></a> module, we
guarantee that all errors will match
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#Error"><code>proto.Error</code></a>
according to <a href="https://pkg.go.dev/errors?tab=doc#Is"><code>errors.Is</code></a>.</p><h3 id=unstable-json>Why does the output of <a href=https://pkg.go.dev/google.golang.org/protobuf/encoding/protojson><code>protojson</code></a> keep changing?</h3><p>We make no promises about the long-term stability of Go&rsquo;s implementation of the
<a href=/programming-guides/proto3#json>JSON format for protocol buffers</a>.
The specification only specifies what is valid JSON, but provides no
specification for a <em>canonical</em> format for how a marshaler ought to <em>exactly</em>
format a given message. To avoid giving the illusion that the output is stable,
we deliberately introduce minor differences so that byte-for-byte comparisons
are likely to fail.</p><p>To gain some degree of output stability, we recommend running the output through
a JSON formatter.</p><h3 id=unstable-text>Why does the output of <a href=https://pkg.go.dev/google.golang.org/protobuf/encoding/prototext><code>prototext</code></a> keep changing?</h3><p>We make no promises about the long-term stability of Go&rsquo;s implementation of the
text format. There is no canonical specification of the protobuf text format,
and we would like to preserve the ability to make improvements in the
<code>prototext</code> package output in the future. Since we don&rsquo;t promise stability in
the package&rsquo;s output, we&rsquo;ve deliberately introduced instability to discourage
users from depending on it.</p><p>To obtain some degree of stability, we recommend passing the output of
<code>prototext</code> through the
<a href=https://github.com/protocolbuffers/txtpbfmt><code>txtpbfmt</code></a> program. The formatter
can be directly invoked in Go using
<a href="https://pkg.go.dev/github.com/protocolbuffers/txtpbfmt/parser?tab=doc#Format"><code>parser.Format</code></a>.</p><h2 id=miscellaneous>Miscellaneous</h2><h3 id=hash>How do I use a protocol buffer message as a hash key?</h3><p>You need canonical serialization, where the marshaled output of a protocol
buffer message is guaranteed to be stable over time. Unfortunately, no
specification for canonical serialization exists at this time. You&rsquo;ll need to
write your own or find a way to avoid needing one.</p><h3 id=new-feature>Can I add a new feature to the Go protocol buffer implementation?</h3><p>Maybe. We always like suggestions, but we&rsquo;re very cautious about adding new
things.</p><p>The Go implementation of protocol buffers strives to be consistent with the
other language implementations. As such, we tend to shy away from feature that
are overly specialized to just Go. Go-specific features hinder the goal of
protocol buffers being a language-neutral data interchange format.</p><p>Unless your idea is specific to the Go implementation, you should join the
<a href=http://groups.google.com/group/protobuf>protobuf discussion group</a> and suggest
it there.</p><p>If you have an idea for the Go implementation, file an issue on our issue
tracker:
<a href=https://github.com/golang/protobuf/issues>https://github.com/golang/protobuf/issues</a></p><h3 id=new-marshal-option>Can I add an option to <code>Marshal</code> or <code>Unmarshal</code> to customize it?</h3><p>Only if that option exists in other implementations (e.g., C++, Java). The
encoding of protocol buffers (binary, JSON, and text) must be consistent across
implementations, so a program written in one language is able to read messages
written by another one.</p><p>We will not add any options to the Go implementation that affect the data output
by <code>Marshal</code> functions or read by <code>Unmarshal</code> functions unless an equivalent
option exist in at least one other supported implementation.</p><h3 id=custom-code>Can I customize the code generated by <code>protoc-gen-go</code>?</h3><p>In general, no. Protocol buffers are intended to be a language-agnostic data
interchange format, and implementation-specific customizations run counter to
that intent.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-639e5cf8cb099a7e10c83b371a06eedd>3 - Go API</h1></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=40px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#fff data-fg=#000 data-position=bottom data-padding=16px data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=40px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#fff data-fg=#000 data-position=bottom data-padding=16px data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.9bf72cb065abb58e9dd4b5b0081420fe52b7f1d05088aa753cd0a5cff0f04feb.js integrity="sha256-m/cssGWrtY6d1LWwCBQg/lK38dBQiKp1PNClz/DwT+s=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>